# Maintainer: ArchStrike <archstrikelinux@gmail.com>

buildarch=212

pkgname=bro
pkgver=2.4.1
pkgrel=1
pkgdesc="A highly configurable IDS"
arch=('i686' 'x86_64' 'armv6h' 'armv7h')
url="http://bro-ids.org/"
backup=(etc/bro/{broccoli.conf,broctl.cfg,networks.cfg,node.cfg})
license=('BSD')
depends=('libpcap' 'curl' 'ruby' 'file' 'geoip' 'python2' 'gperftools')
makedepends=('cmake' 'swig')
install=${pkgname}.install
groups=('archstrike')
options=('!emptydirs')
source=("https://www.bro.org/downloads/release/bro-$pkgver.tar.gz")
sha512sums=('4f7bf6c037fe7b16214830d2dba9f7abffd853f66030aa710fb9f174a475f8cd27d8de6bacf965f142f942a42093ceb78dcd8cbcedac6fbcfdd65ac07b3dd410')

build() {
  cd $srcdir/$pkgname-$pkgver
  ./configure --prefix="/usr" --conf-files-dir="/etc/bro" --spooldir="/usr/share/bro" \
  --logdir="/usr/share/bro/logs" --localstatedir="/var/spool" --with-python=/usr/bin/python2  --enable-ruby \
  --enable-mobile-ipv6
  make DESTDIR="$pkgdir"
}

package() {
  cd $srcdir/$pkgname-$pkgver
  mkdir -p $pkgdir/usr/share/bro/logs
  make DESTDIR="$pkgdir/" install
  install -Dm644 COPYING $pkgdir/usr/share/licenses/$pkgname/COPYING
  find "${pkgdir}" -type f | xargs sed -i "/# This file was automatically generated by bifcl/d"
  find "${pkgdir}" -type f | xargs sed -i 's|/usr/bin/env python|/usr/bin/env python2|'
}
