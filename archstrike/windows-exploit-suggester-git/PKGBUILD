# Maintainer: ArchStrike <team@archstrike.org>

buildarch=1

pkgname=windows-exploit-suggester-git
pkgver=20161031.r39
pkgrel=1
groups=('archstrike' 'archstrike-exploit')
arch=('any')
pkgdesc="Compares a target patch levels against the Microsoft vulnerability database to detect potential missing patches on the target. Also notifies the user if there are public exploits and Metasploit modules available for missing bulletins"
url="https://github.com/GDSSecurity/Windows-Exploit-Suggester"
license=('GPL3')
depends=('python2' 'python2-xlrd')
makedepends=('git')
source=("$pkgname::git+https://github.com/GDSSecurity/Windows-Exploit-Suggester.git")
sha512sums=('SKIP')

prepare() {
  cd $pkgname
  sed -i 's|python$|python2|g' windows-exploit-suggester.py
}

pkgver() {
  cd $pkgname
  printf "%s.r%s" "$(git show -s --format=%ci master | sed 's/\ .*//g;s/-//g')" "$(git rev-list --count HEAD)"
}

package() {
  cd $pkgname
  install -dm755 "$pkgdir/usr/bin"
  install -dm755 "$pkgdir/usr/share/$pkgname"
  install -Dm755 windows-exploit-suggester.py "$pkgdir/usr/share/$pkgname/windows-exploit-suggester"

cat > "$pkgdir/usr/bin/windows-exploit-suggester" <<EOF
#!/bin/sh
cd /usr/share/$pkgname
python2 windows-exploit-suggester "\$@"
EOF
chmod 755 "$pkgdir/usr/bin/windows-exploit-suggester"
}
